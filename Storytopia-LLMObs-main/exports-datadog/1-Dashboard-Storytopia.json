{"title":"Storytopia LLMObs Dashboard","description":"Track LLM model usage, cost, latency, and performance of your LLM applications.\n\n[LLM application traces ↗](/llm/traces) | [Docs ↗](https://docs.datadoghq.com/tracing/llm_observability/) | [Instrument your LLM application ↗](https://docs.datadoghq.com/tracing/llm_observability/trace_an_llm_application/)\n\nEmpty dashboard? Start by annotating your LLM application’s LLM call: [Python SDK doc ↗](https://docs.datadoghq.com/llm_observability/setup/sdk/python/#annotating-a-span) | [Node.js SDK doc ↗](https://docs.datadoghq.com/llm_observability/setup/sdk/nodejs/#annotating-a-span) | [API doc ↗](https://docs.datadoghq.com/tracing/llm_observability/api/?tab=model#spans-api)\n\nFor insights into LLM chains and spans, go to [LLM Observability LLM Chain Insights](/dash/integration/llm_chain_insights) Dashboard \n\nFor insights into out-of-the-box, user sessions, and custom evaluations, go to [LLM Observability Evaluation](/dash/integration/llm_evaluations)  Dashboard (cloned)","widgets":[{"id":3444086504619146,"definition":{"title":"","banner_img":"/static/images/integration_dashboard/llm-observability_hero-1.jpeg","show_title":true,"type":"group","layout_type":"ordered","widgets":[]},"layout":{"x":0,"y":0,"width":6,"height":3}},{"id":56761194173949,"definition":{"type":"image","url":"https://raw.githubusercontent.com/Harpita-P/Storytopia/ae992a8d54e8abb6a760205117f5fc414370bf90/Storytopia-Main.png","sizing":"cover","has_background":true,"has_border":true,"vertical_align":"center","horizontal_align":"center"},"layout":{"x":6,"y":0,"width":3,"height":3}},{"id":6925805930371330,"definition":{"title":"LLM Operational Insights","background_color":"vivid_orange","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":5504308507814998,"definition":{"title":"Average Cost Per Story","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"nanodollar"}},"formula":"(metric1 + metric2 + metric3 + metric4) / 7"}],"queries":[{"data_source":"llm_observability","name":"metric1","indexes":["llmobs"],"compute":{"aggregation":"sum","metric":"@metrics.estimated_non_cached_input_cost"},"group_by":[],"search":{"query":"@ml_app:storytopia-backend @event_type:span @parent_id:*"}},{"data_source":"llm_observability","name":"metric2","indexes":["llmobs"],"compute":{"aggregation":"sum","metric":"@metrics.estimated_cache_read_input_cost"},"group_by":[],"search":{"query":"@ml_app:storytopia-backend @event_type:span @parent_id:*"}},{"data_source":"llm_observability","name":"metric3","indexes":["llmobs"],"compute":{"aggregation":"sum","metric":"@metrics.estimated_cache_write_input_cost"},"group_by":[],"search":{"query":"@ml_app:storytopia-backend @event_type:span @parent_id:*"}},{"data_source":"llm_observability","name":"metric4","indexes":["*"],"compute":{"aggregation":"sum","metric":"@metrics.estimated_output_cost"},"group_by":[],"search":{"query":"@ml_app:storytopia-backend @event_type:span @parent_id:*"}}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":3,"palette":"white_on_red"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":0,"y":0,"width":3,"height":3}},{"id":3482460852692924,"definition":{"title":"Avg LLM Response Latency ","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"second"}},"formula":"query1"}],"queries":[{"aggregator":"avg","data_source":"metrics","name":"query1","query":"avg:ml_obs.span.duration{$env,$service,$version,$model_provider, $ml_app, span_kind:llm}"}],"response_format":"scalar","conditional_formats":[{"comparator":"<","value":30,"palette":"custom_text","custom_fg_color":"#db297f"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars","yaxis":{}}},"layout":{"x":3,"y":0,"width":3,"height":3}},{"id":7403444364106132,"definition":{"title":"Total LLM Requests","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"llm_observability","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[],"search":{"query":"@event_type:span $ml_app $version $env $service @meta.model_provider:$model_provider.value @meta.span.kind:llm"}}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":100,"palette":"white_on_yellow"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"area","yaxis":{"include_zero":false}}},"layout":{"x":6,"y":0,"width":2,"height":3}},{"id":3835649873165936,"definition":{"title":"Avg Input Tokens per LLM Call","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"number_format":{"unit":{"type":"custom_unit_label","label":"tokens/call"}},"formula":"query1 / query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:ml_obs.span.llm.input.tokens{$ml_app,$version,$env,$service, $model_provider}.as_count()","aggregator":"avg"},{"data_source":"metrics","name":"query2","query":"sum:ml_obs.span{$ml_app,span_kind:llm,$version,$env,$service, $model_provider}.as_count()","aggregator":"avg"}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":1.2,"palette":"black_on_light_green"}]}],"autoscale":true,"custom_links":[{"label":"View related spans in LLM Observability","link":"/llm/traces?query=@event_type%3Aspan%20@parent_id%3A*%20@meta.span.kind%3Allm%20@{{$ml_app}}%20{{$version}}&start={{timestamp_widget_start}}&end={{timestamp_widget_end}}&paused=false"}],"precision":2,"timeseries_background":{"type":"bars","yaxis":{}}},"layout":{"x":8,"y":0,"width":2,"height":3}},{"id":3960916621633432,"definition":{"title":"Avg Output Tokens per LLM Call","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"number_format":{"unit":{"type":"custom_unit_label","label":"tokens/call"}},"formula":"query1 / query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:ml_obs.span.llm.output.tokens{$ml_app,$version,$env,$service, $model_provider}.as_count()","aggregator":"avg"},{"data_source":"metrics","name":"query2","query":"sum:ml_obs.span{$ml_app,span_kind:llm,$version,$env,$service, $model_provider}.as_count()","aggregator":"avg"}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":300,"palette":"green_on_white"}]}],"autoscale":true,"custom_links":[{"label":"View related traces in LLM Observability","link":"/llm/traces?query=@event_type%3Aspan%20@parent_id%3A*%20@meta.span.kind%3Allm%20@{{$ml_app}}%20{{$version}}&start={{timestamp_widget_start}}&end={{timestamp_widget_end}}&paused=false"}],"precision":2,"timeseries_background":{"type":"bars","yaxis":{}}},"layout":{"x":10,"y":0,"width":2,"height":3}},{"id":3151345683848596,"definition":{"title":"Model Usage","requests":[{"queries":[{"data_source":"llm_observability","name":"query2","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[{"facet":"@meta.model_provider","limit":10,"sort":{"order":"desc","aggregation":"count"}},{"facet":"@meta.model_name","limit":10,"sort":{"order":"desc","aggregation":"count"}}],"search":{"query":"@event_type:span $ml_app $version $env $service @meta.model_provider:$model_provider.value @meta.span.kind:llm"}}],"response_format":"scalar","style":{"palette":"datadog16"},"formulas":[{"formula":"query2"}],"sort":{"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"type":"sunburst","legend":{"type":"automatic"},"custom_links":[{"label":"View related spans in LLM Observability","link":"/llm/traces?query=@meta.model_name%3A{{@meta.model_name.value}}%20@event_type%3Aspan%20@parent_id%3A*%20@{{$ml_app}}%20{{$version}}&start={{timestamp_widget_start}}&end={{timestamp_widget_end}}&paused=false"}]},"layout":{"x":0,"y":3,"width":3,"height":3}},{"id":2819887241075640,"definition":{"title":"Trace Execution Time by Span Kind","requests":[{"queries":[{"data_source":"llm_observability","name":"query1","indexes":["*"],"compute":{"aggregation":"pc95","metric":"@duration"},"group_by":[{"facet":"@meta.span.kind","limit":10,"sort":{"order":"desc","aggregation":"pc95","metric":"@duration"}}],"search":{"query":"@event_type:span -@parent_id:undefined $ml_app $version $env $service $model_provider"}}],"response_format":"scalar","style":{"palette":"datadog16"},"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"nanosecond"}},"formula":"query1"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"type":"sunburst","legend":{"type":"inline"},"custom_links":[{"label":"View related spans in LLM Observability","link":"/llm/traces?query=@event_type%3Aspan%20@parent_id%3A*%20@{{$ml_app}}%20{{$version}}%20@meta.span.kind%3A{{@meta.span.kind.value}}&start={{timestamp_widget_start}}&end={{timestamp_widget_end}}&paused=false"}]},"layout":{"x":3,"y":3,"width":3,"height":3}},{"id":8614866922979184,"definition":{"title":"LLM Call Response Time by ML App (p95)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"horizontal","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"number_format":{"unit":{"type":"custom_unit_label","label":"seconds"}},"alias":"p95","formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"p95:ml_obs.span.duration{$ml_app,$version,span_kind:llm,$env,$service, $model_provider} by {ml_app}"}],"response_format":"timeseries","style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}],"markers":[],"custom_links":[{"label":"View related traces in LLM Observability","link":"/llm/traces?query=@event_type%3Aspan%20@parent_id%3A*%20@ml_app%3A{{ml_app.value}}%20{{$version}}&start={{timestamp_widget_start}}&end={{timestamp_widget_end}}&paused=false"}]},"layout":{"x":6,"y":3,"width":6,"height":3}},{"id":246716173430280,"definition":{"title":"Total Number of Traces","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query7","number_format":{"unit":{"type":"custom_unit_label","label":"traces"}}}],"queries":[{"data_source":"llm_observability","name":"query7","indexes":["*"],"compute":{"aggregation":"cardinality","metric":"@trace_id"},"group_by":[],"search":{"query":"@event_type:span $ml_app $version $env $service $ml_app @meta.model_provider:$model_provider.value"}}],"response_format":"scalar"}],"autoscale":true,"custom_links":[{"label":"View related traces in LLM Observability","link":"/llm/traces?query=@event_type%3Aspan%20@parent_id%3Aundefined%20@{{$ml_app}}%20{{$version}}&start={{timestamp_start}}&end={{timestamp_end}}&paused=false"}],"precision":2,"timeseries_background":{"type":"bars","yaxis":{}}},"layout":{"x":0,"y":6,"width":3,"height":3}},{"id":2941224801013446,"definition":{"title":"Trace Error Rate","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"fraction"}},"formula":"1 - (query1 / query2)"}],"queries":[{"data_source":"llm_observability","name":"query1","indexes":["*"],"compute":{"aggregation":"cardinality","metric":"@trace_id"},"group_by":[],"search":{"query":"@event_type:span $ml_app $version $env $service @meta.model_provider:$model_provider.value @status:ok"}},{"data_source":"llm_observability","name":"query2","indexes":["*"],"compute":{"aggregation":"cardinality","metric":"@trace_id"},"group_by":[],"search":{"query":"@event_type:span $ml_app $version $env $service @meta.model_provider:$model_provider.value"}}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":0,"palette":"black_on_light_red"}]}],"autoscale":true,"custom_links":[{"label":"View related traces in LLM Observability","link":"/llm/traces?query=@event_type%3Aspan%20@parent_id%3Aundefined%20@{{$ml_app}}%20@status%3Aerror%20{{$version}}&start={{timestamp_start}}&end={{timestamp_end}}&paused=false"}],"precision":2,"timeseries_background":{"type":"area","yaxis":{"include_zero":false}}},"layout":{"x":3,"y":6,"width":3,"height":3}},{"id":8491486279677864,"definition":{"title":"Total Token Usage by Prompt & Completion","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"horizontal","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"number_format":{"unit":{"type":"custom_unit_label","label":"tokens"}},"alias":"Prompt Tokens","formula":"query1"},{"number_format":{"unit":{"type":"custom_unit_label","label":"tokens"}},"alias":"Completion Tokens","formula":"query2"},{"number_format":{"unit":{"type":"custom_unit_label","label":"tokens"}},"alias":"Total Tokens","formula":"query3"},{"number_format":{"unit":{"type":"custom_unit_label","label":"tokens"}},"alias":"Cache Read Tokens","formula":"query4"},{"number_format":{"unit":{"type":"custom_unit_label","label":"tokens"}},"alias":"Cache Write Tokens","formula":"query5"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:ml_obs.span.llm.input.tokens{$ml_app,$version,$env,$service, $model_provider}.as_count()"},{"data_source":"metrics","name":"query2","query":"sum:ml_obs.span.llm.output.tokens{$ml_app,$version,$env,$service, $model_provider}.as_count()"},{"data_source":"metrics","name":"query3","query":"sum:ml_obs.span.llm.total.tokens{$ml_app,$version,$env,$service, $model_provider}.as_count()"},{"data_source":"metrics","name":"query4","query":"sum:ml_obs.span.llm.input.cache_read.tokens{$ml_app,$version,$env,$service, $model_provider}.as_count()"},{"data_source":"metrics","name":"query5","query":"sum:ml_obs.span.llm.input.cache_write.tokens{$ml_app,$version,$env,$service, $model_provider}.as_count()"}],"response_format":"timeseries","style":{"palette":"datadog16","line_type":"solid","line_width":"normal"},"display_type":"line"}],"markers":[],"custom_links":[{"label":"View related traces in LLM Observability","link":"/llm/traces?query=@event_type%3Aspan%20@parent_id%3Aundefined%20@{{$ml_app}}%20{{$version}}&start={{timestamp_widget_start}}&end={{timestamp_widget_end}}&paused=false"}]},"layout":{"x":6,"y":6,"width":6,"height":3}},{"id":7246505446173211,"definition":{"title":"Storytopia's Most Expensive LLM Calls","title_size":"16","title_align":"left","requests":[{"response_format":"event_list","query":{"data_source":"llm_observability_stream","query_string":"@ml_app:storytopia-backend @event_type:span @parent_id:* (@meta.span.kind:llm OR @meta.span.kind:embedding)","indexes":["llmobs"],"sort":{"column":"@metrics.estimated_total_cost","order":"desc"}},"columns":[{"field":"@status","width":"auto"},{"field":"timestamp","width":"auto"},{"field":"@name","width":"auto"},{"field":"@metrics.estimated_input_cost","width":"auto"},{"field":"@metrics.estimated_output_cost","width":"auto"},{"field":"@metrics.estimated_total_cost","width":"auto"}]}],"type":"list_stream"},"layout":{"x":0,"y":9,"width":12,"height":3}}]},"layout":{"x":0,"y":3,"width":12,"height":13,"is_column_break":true}},{"id":3009356634161873,"definition":{"title":"Custom Agent Evaluation Insights for Storytopia","background_color":"vivid_orange","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":4400971176624944,"definition":{"title":"Avg Creative Intent Score ","title_size":"16","title_align":"left","type":"query_value","requests":[{"queries":[{"data_source":"llm_observability","compute":{"aggregation":"avg","metric":"@evaluations.custom.creative_intent_score"},"name":"query1","group_by":[],"indexes":["*"],"search":{"query":"@event_type:span @parent_id:undefined @ml_app:storytopia-backend"}}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":0.9,"palette":"black_on_light_green"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"area","yaxis":{"include_zero":false}}},"layout":{"x":0,"y":0,"width":3,"height":3}},{"id":7506277550087995,"definition":{"title":"Potentially Harmful Content Flagged","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query2 * 100","number_format":{"unit":{"type":"canonical_unit","unit_name":"percent"}}}],"queries":[{"data_source":"llm_observability","name":"query2","indexes":["llmobs"],"compute":{"aggregation":"avg","metric":"@evaluations.custom.inappropriate_content_flag"},"group_by":[],"search":{"query":"@ml_app:storytopia-backend @event_type:span @parent_id:*"}}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":10,"palette":"black_on_light_red"}]}],"autoscale":true,"precision":1,"timeseries_background":{"type":"bars","yaxis":{}}},"layout":{"x":3,"y":0,"width":3,"height":3}},{"id":4554998448376040,"definition":{"title":"Avg Story Lesson Alignment Score ","title_size":"16","title_align":"left","type":"query_value","requests":[{"queries":[{"data_source":"llm_observability","name":"query","indexes":["llmobs"],"compute":{"aggregation":"avg","metric":"@evaluations.custom.lesson_alignment_score"},"group_by":[],"search":{"query":"@ml_app:storytopia-backend @event_type:span @parent_id:*"}}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":0.9,"palette":"custom_bg","custom_bg_color":"#f8ffc2"},{"comparator":"<","value":0.9,"palette":"white_on_red"}]}],"autoscale":true,"precision":2},"layout":{"x":6,"y":0,"width":3,"height":3}},{"id":7826444766282325,"definition":{"title":"Avg Illustrator Consistency Score","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_value","requests":[{"formulas":[{"formula":"avg"}],"queries":[{"data_source":"llm_observability","name":"avg","indexes":["llmobs"],"compute":{"aggregation":"avg","metric":"@evaluations.custom.illustrator_consistency"},"group_by":[],"search":{"query":"@ml_app:storytopia-backend @event_type:span @parent_id:*"}}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":0.8,"palette":"black_on_light_green"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars","yaxis":{}}},"layout":{"x":9,"y":0,"width":3,"height":3}}]},"layout":{"x":0,"y":16,"width":12,"height":4}},{"id":5281684962830999,"definition":{"title":"Alert Monitors","type":"manage_status","display_format":"countsAndList","color_preference":"background","hide_zero_counts":true,"show_status":true,"last_triggered_format":"relative","query":"","sort":"status,desc","count":50,"start":0,"summary_type":"combined","show_priority":false,"show_last_triggered":false},"layout":{"x":0,"y":0,"width":12,"height":5}},{"id":6083052857829558,"definition":{"title":"Quality of Character Detail Generated by Visionizer Agent overtime","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"queries":[{"data_source":"llm_observability","compute":{"aggregation":"avg","metric":"@evaluations.custom.creative_intent_score"},"name":"query1","group_by":[],"indexes":["*"],"search":{"query":"@event_type:span @parent_id:undefined @ml_app:storytopia-backend"}}],"response_format":"timeseries","style":{"palette":"orange","order_by":"values","order_reverse":false,"color_order":"shuffled","line_type":"solid","line_width":"thick"},"display_type":"bars"}]},"layout":{"x":0,"y":5,"width":6,"height":3}},{"id":146356753074117,"definition":{"title":"Drawings Flagged as Inappropriate during Safety Check","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"style":{"palette":"warm","palette_index":5},"formula":"query2"}],"queries":[{"data_source":"llm_observability","name":"query2","indexes":["llmobs"],"compute":{"aggregation":"avg","metric":"@evaluations.custom.inappropriate_content_flag"},"group_by":[],"search":{"query":"@ml_app:storytopia-backend @event_type:span @parent_id:*"}}],"response_format":"timeseries","style":{"palette":"purple","order_by":"values","line_type":"dotted","line_width":"thick"},"display_type":"line"}],"markers":[{"value":"y = 1","display_type":"error dashed"},{"value":"y = 0.1","display_type":"ok dashed"}]},"layout":{"x":6,"y":5,"width":6,"height":3}},{"id":4594926885159758,"definition":{"title":"Story Narration TTS Hits","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"type":"live","unit":"month","value":1},"type":"timeseries","requests":[{"queries":[{"data_source":"llm_observability","name":"query","indexes":["llmobs"],"compute":{"aggregation":"avg","metric":"@evaluations.custom.tts_status"},"group_by":[],"search":{"query":"@ml_app:storytopia-backend @event_type:span @parent_id:*"}}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":8,"width":4,"height":2}}],"template_variables":[{"name":"ml_app","prefix":"ml_app","available_values":[],"default":"*"},{"name":"version","prefix":"version","available_values":[],"default":"*"},{"name":"env","prefix":"env","available_values":[],"default":"*"},{"name":"service","prefix":"service","available_values":[],"default":"*"},{"name":"model_provider","prefix":"model_provider","available_values":[],"default":"*"}],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed","pause_auto_refresh":false}